
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Biblioteca Virtual</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #007AFF;
      --secondary: #FF2D55;
      --light: #FAFAFA;
      --dark: #333333;
      --text-secondary: #666666;
      --border-color: #E0E0E0;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--light);
      color: var(--dark);
    }
    
    .category-btn {
      transition: all 0.3s ease;
      border-bottom: 2px solid transparent;
      color: #555555;
      font-size: 14px;
    }
    
    .category-btn.active {
      background-color: transparent;
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
    }
    
    .book-card {
      transition: all 0.3s ease;
      height: 100%;
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }
    
    .book-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.08);
    }
    
    .book-cover {
      aspect-ratio: 2/3;
      object-fit: cover;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }
    
    .modal-overlay {
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .loader {
      border-top-color: var(--primary);
      animation: spinner 0.6s linear infinite;
    }
    
    @keyframes spinner {
      to {transform: rotate(360deg);}
    }
    
    .book-viewed::after {
      content: "";
      position: absolute;
      top: 10px;
      right: 10px;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--secondary);
      border: 2px solid white;
    }
    
    .search-bar:focus {
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
    }

    .pagination-dot {
      transition: all 0.2s ease;
    }
    
    .pagination-dot.active {
      background-color: var(--primary);
      transform: scale(1.3);
    }

    #pdf-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .pdf-error {
      background: #fee2e2;
      border: 1px solid #fecaca;
      color: #dc2626;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight text-primary">
          <i class="fas fa-book-open mr-2 text-gray-600"></i>Biblioteca Virtual
        </h1>
        <div class="relative w-full md:w-1/3">
          <input 
            type="text" 
            id="search" 
            class="search-bar w-full py-2 pl-10 pr-4 bg-white rounded-lg border border-gray-300 shadow-inner text-gray-700 placeholder-gray-400 focus:outline-none" 
            placeholder="Buscar por título o autor..."
          >
          <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Categorías -->
  <div class="bg-white shadow-sm">
    <div class="container mx-auto px-4 py-3">
      <div class="flex flex-wrap gap-4 justify-center md:justify-start">
        <button class="category-btn active px-3 py-2 font-medium" data-category="all">Todos</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="literatura">Literatura</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="ciencia">Ciencia</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="historia">Historia</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="tecnologia">Tecnología</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="arte">Arte</button>
      </div>
    </div>
  </div>
  
  <!-- Contenedor principal -->
  <main class="container mx-auto px-4 py-8">
    <!-- Estado de carga -->
    <div id="loading-state" class="flex flex-col items-center justify-center py-20">
      <div class="loader h-12 w-12 border-4 border-gray-200 rounded-full"></div>
      <p class="mt-4 text-gray-600">Cargando biblioteca...</p>
    </div>
    
    <!-- Estado de error -->
    <div id="error-state" class="hidden flex flex-col items-center justify-center py-20 text-center">
      <div class="bg-red-100 p-6 rounded-lg">
        <i class="fas fa-exclamation-triangle text-red-500 text-5xl mb-4"></i>
        <h3 class="text-xl font-bold text-red-700">¡Ups! Algo salió mal</h3>
        <p class="text-red-600 mt-2">No pudimos cargar los libros. Por favor intenta de nuevo más tarde.</p>
        <button id="retry-button" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300">
          <i class="fas fa-redo mr-2"></i>Reintentar
        </button>
      </div>
    </div>
    
    <!-- Estado vacío -->
    <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center">
      <i class="fas fa-search text-6xl text-gray-400 mb-4"></i>
      <h3 class="text-xl font-bold text-gray-700">No encontramos resultados</h3>
      <p class="text-gray-600 mt-2">Intenta con otra búsqueda o categoría</p>
    </div>
    
    <!-- Grid de libros -->
    <div id="books-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <!-- Los libros se cargarán dinámicamente aquí -->
    </div>
    
    <!-- Paginación -->
    <div id="pagination" class="hidden flex justify-center items-center space-x-2 mt-10">
      <button id="prev-page" class="px-4 py-2 rounded-full border border-gray-300 hover:bg-gray-100">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div id="pagination-dots" class="flex space-x-2">
        <!-- Dots generados dinámicamente -->
      </div>
      <button id="next-page" class="px-4 py-2 rounded-full border border-gray-300 hover:bg-gray-100">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </main>
  
  <!-- Modal para visualizar PDF -->
  <div id="pdf-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-6xl h-full md:h-5/6 rounded-xl shadow-lg flex flex-col relative overflow-hidden">
      <!-- Header del modal -->
      <div class="flex justify-between items-center p-4 border-b">
        <h3 id="modal-book-title" class="text-xl font-semibold truncate">Título del libro</h3>
        <div class="flex items-center space-x-2">
          <button id="open-new-tab" class="text-gray-500 hover:text-gray-700" title="Abrir en nueva pestaña">
            <i class="fas fa-external-link-alt text-lg"></i>
          </button>
          <button id="close-modal" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>
      
      <!-- Contenedor del PDF -->
      <div id="pdf-container" class="flex-grow overflow-hidden relative">
        <!-- PDF Iframe -->
        <iframe id="pdf-iframe" class="hidden"></iframe>
        
        <!-- Visor personalizado -->
        <div id="pdf-viewer" class="h-full" style="display: none;"></div>
        
        <!-- Mensaje de carga del PDF -->
        <div id="pdf-loading" class="absolute inset-0 flex flex-col items-center justify-center bg-white">
          <div class="loader h-10 w-10 border-4 border-gray-200 rounded-full"></div>
          <p class="mt-4 text-gray-600">Cargando documento...</p>
        </div>
        
        <!-- Mensaje de error -->
        <div id="pdf-error" class="hidden absolute inset-0 flex flex-col items-center justify-center p-8">
          <div class="pdf-error rounded-lg p-6 text-center max-w-md">
            <i class="fas fa-file-pdf text-4xl mb-4"></i>
            <h3 class="text-lg font-bold mb-2">No se pudo cargar el PDF</h3>
            <p class="mb-4">El archivo no se encuentra disponible o hay un problema de conexión.</p>
            <button id="retry-pdf" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
              Reintentar
            </button>
          </div>
        </div>
      </div>
      
      <!-- Controles de navegación y favoritos -->
      <div class="flex justify-between items-center p-4 border-t bg-white">
        <div class="flex items-center space-x-2">
          <button id="prev-page-btn" class="px-4 py-2 rounded-lg border border-gray-200 hover:border-blue-500 hover:text-blue-500 transition">
            <i class="fas fa-chevron-left mr-1"></i> Anterior
          </button>
          <span id="page-info" class="text-sm text-gray-600">Página <span id="current-page">1</span> de <span id="total-pages">?</span></span>
          <button id="next-page-btn" class="px-4 py-2 rounded-lg border border-gray-200 hover:border-blue-500 hover:text-blue-500 transition">
            Siguiente <i class="fas fa-chevron-right ml-1"></i>
          </button>
        </div>
        
        <div class="flex items-center space-x-2">
          <button id="bookmark-btn" class="p-2 rounded-lg border border-gray-200 hover:border-yellow-400 hover:text-yellow-600 transition" title="Agregar a favoritos">
            <i class="far fa-bookmark"></i>
          </button>
          <button id="zoom-in-btn" class="p-2 rounded-lg border border-gray-200 hover:border-blue-500 hover:text-blue-500 transition" title="Acercar">
            <i class="fas fa-search-plus"></i>
          </button>
          <button id="zoom-out-btn" class="p-2 rounded-lg border border-gray-200 hover:border-blue-500 hover:text-blue-500 transition" title="Alejar">
            <i class="fas fa-search-minus"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuración básica
    const ITEMS_PER_PAGE = 12;
    let currentPage = 1;
    let currentCategory = 'all';
    let searchQuery = '';
    let allBooks = [];
    let filteredBooks = [];
    let currentBookUrl = '';
    let currentBookId = null;
    
    // Referencias a elementos DOM
    const booksGrid = document.getElementById('books-grid');
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const emptyState = document.getElementById('empty-state');
    const retryButton = document.getElementById('retry-button');
    const searchInput = document.getElementById('search');
    const categoryButtons = document.querySelectorAll('.category-btn');
    const pdfModal = document.getElementById('pdf-modal');
    const closeModal = document.getElementById('close-modal');
    const openNewTab = document.getElementById('open-new-tab');
    const modalBookTitle = document.getElementById('modal-book-title');
    const pdfIframe = document.getElementById('pdf-iframe');
    const pdfLoading = document.getElementById('pdf-loading');
    const pdfError = document.getElementById('pdf-error');
    const retryPdf = document.getElementById('retry-pdf');
    const pagination = document.getElementById('pagination');
    const paginationDots = document.getElementById('pagination-dots');
    const prevPagePagination = document.getElementById('prev-page');
    const nextPagePagination = document.getElementById('next-page');
    const bookmarkBtn = document.getElementById('bookmark-btn');
    const zoomInBtn = document.getElementById('zoom-in-btn');
    const zoomOutBtn = document.getElementById('zoom-out-btn');
    const prevPageBtn = document.getElementById('prev-page-btn');
    const nextPageBtn = document.getElementById('next-page-btn');
    const currentPageSpan = document.getElementById('current-page');
    const totalPagesSpan = document.getElementById('total-pages');
    
    // Datos de libros con PDFs reales y funcionales
    function fetchBooks() {
      return new Promise((resolve) => {
        const mockBooks = [
          // 5 libros con PDFs reales que funcionan
          {
            id: 1,
            title: "Eloquent JavaScript",
            author: "Marijn Haverbeke",
            category: "tecnologia",
            cover: "https://images.unsplash.com/photo-1581091012184-5c8f88e6a57b?w=400",
            pdfUrl: "https://eloquentjavascript.net/Eloquent_JavaScript.pdf",
            hasRealPdf: true
          },
          {
            id: 2,
            title: "University Physics Vol. 1",
            author: "OpenStax",
            category: "fisica",
            cover: "https://images.unsplash.com/photo-1603791440384-56cd371ee9a7?w=400",
            pdfUrl: "https://d3bxy9euw4e147.cloudfront.net/oscms-prodcms/media/documents/UniversityPhysicsVolume1-LR.pdf",
            hasRealPdf: true
          },
          {
            id: 3,
            title: "Principles of Management",
            author: "OpenStax",
            category: "economia",
            cover: "https://images.unsplash.com/photo-1574775795456-2db0dc1a5854?w=400",
            pdfUrl: "https://assets.openstax.org/oscms-prodcms/media/documents/PrinciplesofManagement-OP_mGBMvoU.pdf",
            hasRealPdf: true
          },
          {
            id: 4,
            title: "Introduction to Philosophy",
            author: "OpenStax",
            category: "filosofia",
            cover: "https://images.unsplash.com/photo-1526318472351-bc6c2ebd0f8d?w=400",
            pdfUrl: "https://assets.openstax.org/oscms-prodcms/media/documents/Introduction_to_Philosophy-WEB_cszrKYp.pdf",
            hasRealPdf: true
          },
          {
            id: 5,
            title: "Introduction to Python Programming",
            author: "OpenStax",
            category: "programacion",
            cover: "https://images.unsplash.com/photo-1564869733401-ffd9e1b38338?w=400",
            pdfUrl: "https://assets.openstax.org/oscms-prodcms/media/documents/Introduction_to_Python_Programming_-_WEB.pdf",
            hasRealPdf: true
          },
        
          // LIBROS SIMULADOS PARA RELLENO
          {
            id: 6,
            title: "Don Quijote de la Mancha",
            author: "Miguel de Cervantes",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          },
          {
            id: 7,
            title: "El Principito",
            author: "Antoine de Saint-Exupéry",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          },
          
          // LIBROS SIMULADOS PARA LLENAR LA BIBLIOTECA
          {
            id: 6,
            title: "Don Quijote de la Mancha",
            author: "Miguel de Cervantes",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          },
          {
            id: 7,
            title: "El Principito",
            author: "Antoine de Saint-Exupéry",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          },
          {
            id: 8,
            title: "Cien años de soledad",
            author: "Gabriel García Márquez",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          },
          {
            id: 9,
            title: "Breve historia del tiempo",
            author: "Stephen Hawking",
            category: "ciencia",
            cover: "https://images.unsplash.com/photo-1446776877081-d282a0f896e2?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          },
          {
            id: 10,
            title: "Historia del Arte",
            author: "E.H. Gombrich",
            category: "arte",
            cover: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400",
            pdfUrl: "simulated",
            hasRealPdf: false
          }
        ];
        
        // Agregar más libros simulados...
        const additionalBooks = [];
        const categories = ['literatura', 'ciencia', 'historia', 'tecnologia', 'arte'];
        const titles = [
          'Python Programming', 'Machine Learning', 'React Fundamentals', 'Data Science',
          '1984', 'Romeo y Julieta', 'La Odisea', 'Hamlet',
          'Física Cuántica', 'Biología Molecular', 'Química Orgánica', 'Matemáticas',
          'Segunda Guerra Mundial', 'Imperio Romano', 'Revolución Francesa', 'Historia Medieval',
          'Diseño Gráfico', 'Fotografía', 'Escultura Moderna', 'Pintura Renacentista'
        ];
        
        titles.forEach((title, index) => {
          additionalBooks.push({
            id: 11 + index,
            title: title,
            author: "Autor Ejemplo",
            category: categories[index % categories.length],
            cover: `https://images.unsplash.com/photo-${1507003211169 + index}?w=400`,
            pdfUrl: "simulated",
            hasRealPdf: false
          });
        });
        
        const allBooksData = [...mockBooks, ...additionalBooks.slice(0, 20)];
        setTimeout(() => resolve(allBooksData), 1000);
      });
    }
    
    // Inicializa la aplicación
    function initApp() {
      showLoadingState();
      
      fetchBooks()
        .then(books => {
          allBooks = books;
          filteredBooks = [...allBooks];
          hideLoadingState();
          renderBooks();
          setupPagination();
        })
        .catch(error => {
          console.error("Error:", error);
          showErrorState();
        });
      
      setupEventListeners();
    }
    
    // Renderiza los libros en el grid
    function renderBooks() {
      booksGrid.innerHTML = '';
      
      const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIndex = startIndex + ITEMS_PER_PAGE;
      const booksToRender = filteredBooks.slice(startIndex, endIndex);
      
      if (booksToRender.length === 0) {
        showEmptyState();
        return;
      }
      
      hideEmptyState();
      booksGrid.classList.remove('hidden');
      
      booksToRender.forEach(book => {
        const bookCard = document.createElement('div');
        bookCard.className = 'book-card bg-white overflow-hidden relative cursor-pointer';
        bookCard.setAttribute('data-id', book.id);
        
        const viewedBooks = JSON.parse(localStorage.getItem('viewedBooks') || '[]');
        if (viewedBooks.includes(book.id)) {
          bookCard.classList.add('book-viewed');
        }
        
        bookCard.innerHTML = `
          <div class="h-48 sm:h-64 overflow-hidden">
            <img src="${book.cover}" alt="${book.title}" class="book-cover w-full h-full object-cover transition-transform duration-500 hover:scale-110">
          </div>
          <div class="p-4">
            <span class="inline-block px-3 py-1 text-xs font-semibold text-white bg-blue-500 rounded-full mb-2">${book.category}</span>
            <h3 class="font-semibold text-lg mb-1 line-clamp-1">${book.title}</h3>
            <p class="text-gray-600 text-sm mb-3">${book.author}</p>
            <button class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300">
              Leer PDF
            </button>
          </div>
        `;
        
        bookCard.addEventListener('click', () => openBookModal(book));
        booksGrid.appendChild(bookCard);
      });
      
      updatePaginationControls();
    }
    
    // Abrir el modal del libro
    function openBookModal(book) {
      pdfModal.classList.remove('hidden');
      modalBookTitle.textContent = book.title;
      currentBookUrl = book.pdfUrl;
      currentBookId = book.id;
      
      // Mostrar estado de carga
      pdfLoading.classList.remove('hidden');
      pdfIframe.classList.add('hidden');
      pdfError.classList.add('hidden');
      
      // Actualizar botón de favoritos
      updateBookmarkButton();
      
      // Cargar PDF
      loadPdf(book.pdfUrl);
      
      // Marcar como visto
      const viewedBooks = JSON.parse(localStorage.getItem('viewedBooks') || '[]');
      if (!viewedBooks.includes(book.id)) {
        viewedBooks.push(book.id);
        localStorage.setItem('viewedBooks', JSON.stringify(viewedBooks));
      }
    }
    
    // Cargar PDF en el iframe
    function loadPdf(pdfUrl) {
      const iframe = pdfIframe;
      
      // Si es un PDF que sabemos que funciona, usar directamente
      const workingPdfs = [
        "https://eloquentjavascript.net/Eloquent_JavaScript.pdf",
        "https://d3bxy9euw4e147.cloudfront.net/oscms-prodcms/media/documents/UniversityPhysicsVolume1-LR.pdf",
        "https://assets.openstax.org/oscms-prodcms/media/documents/PrinciplesofManagement-OP_mGBMvoU.pdf",
        "https://assets.openstax.org/oscms-prodcms/media/documents/Introduction_to_Philosophy-WEB_cszrKYp.pdf",
        "https://assets.openstax.org/oscms-prodcms/media/documents/Introduction_to_Python_Programming_-_WEB.pdf"
      ];
      
      // Para otros archivos, mostrar contenido alternativo
      if (pdfUrl === 'sample.pdf' || !workingPdfs.includes(pdfUrl)) {
        // Mostrar contenido simulado para libros sin PDF real
        setTimeout(() => {
          pdfLoading.classList.add('hidden');
          pdfError.classList.add('hidden');
          iframe.classList.add('hidden');
          
          const pdfViewer = document.getElementById('pdf-viewer') || createPdfViewer();
          pdfViewer.innerHTML = `
            <div class="flex flex-col items-center justify-center h-full p-8 bg-gradient-to-br from-blue-50 to-indigo-100">
              <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl text-center">
                <div class="mb-6">
                  <i class="fas fa-book-open text-6xl text-blue-500 mb-4"></i>
                  <h3 class="text-2xl font-bold text-gray-800 mb-2">Contenido del Libro</h3>
                  <p class="text-gray-600">Aquí se mostraría el contenido completo de "${modalBookTitle.textContent}"</p>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-6 mb-6 text-left">
                  <h4 class="font-semibold text-lg mb-3 text-gray-800">Vista previa del contenido:</h4>
                  <div class="space-y-3 text-gray-700 leading-relaxed">
                    <p><strong>Capítulo 1:</strong> Introducción al tema principal...</p>
                    <p><strong>Capítulo 2:</strong> Desarrollo de conceptos fundamentales...</p>
                    <p><strong>Capítulo 3:</strong> Aplicaciones prácticas y ejemplos...</p>
                    <p class="text-sm italic text-gray-500">... y mucho más contenido disponible en la versión completa.</p>
                  </div>
                </div>
                
                <div class="flex gap-4 justify-center">
                  <button onclick="alert('Función disponible en la versión completa de la biblioteca')" 
                          class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-download mr-2"></i>Descargar PDF
                  </button>
                  <button onclick="alert('Función disponible en la versión completa de la biblioteca')" 
                          class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                    <i class="fas fa-share mr-2"></i>Compartir
                  </button>
                </div>
                
                <p class="text-xs text-gray-500 mt-4">
                  📚 Esta es una demostración. En la versión completa tendríamos acceso al PDF real.
                </p>
              </div>
            </div>
          `;
          
          // Actualizar contador de páginas para simulación
          currentPageSpan.textContent = '1';
          totalPagesSpan.textContent = Math.floor(Math.random() * 200) + 50; // Páginas aleatorias entre 50-250
          
        }, 1000);
        return;
      }
      
      // Para PDFs reales que funcionan
      iframe.onload = function() {
        pdfLoading.classList.add('hidden');
        pdfError.classList.add('hidden');
        iframe.classList.remove('hidden');
        
        // Ocultar el visor personalizado si existe
        const customViewer = document.getElementById('pdf-viewer');
        if (customViewer) {
          customViewer.style.display = 'none';
        }
      };
      
      iframe.onerror = function() {
        pdfLoading.classList.add('hidden');
        iframe.classList.add('hidden');
        pdfError.classList.remove('hidden');
      };
      
      // Usar diferentes métodos para cargar el PDF
      try {
        // Método 1: Google Docs Viewer
        iframe.src = `https://docs.google.com/viewer?url=${encodeURIComponent(pdfUrl)}&embedded=true`;
        
        // Método 2: Fallback directo (para PDFs que permiten iframe)
        setTimeout(() => {
          if (pdfLoading.classList.contains('hidden') === false) {
            iframe.src = pdfUrl;
          }
        }, 5000);
        
      } catch (error) {
        console.error('Error loading PDF:', error);
        pdfLoading.classList.add('hidden');
        iframe.classList.add('hidden');
        pdfError.classList.remove('hidden');
      }
      
      // Timeout final
      setTimeout(() => {
        if (pdfLoading.classList.contains('hidden') === false) {
          pdfLoading.classList.add('hidden');
          pdfError.classList.remove('hidden');
        }
      }, 15000);
    }
    
    // Crear visor personalizado si no existe
    function createPdfViewer() {
      let viewer = document.getElementById('pdf-viewer');
      if (!viewer) {
        viewer = document.createElement('div');
        viewer.id = 'pdf-viewer';
        viewer.className = 'h-full';
        document.getElementById('pdf-container').appendChild(viewer);
      }
      return viewer;
    }
    
    // Actualizar estado del botón de favoritos
    function updateBookmarkButton() {
      const favorites = JSON.parse(localStorage.getItem('favoriteBooks') || '[]');
      const isFavorite = favorites.includes(currentBookId);
      const icon = bookmarkBtn.querySelector('i');
      
      if (isFavorite) {
        icon.classList.remove('far');
        icon.classList.add('fas');
        bookmarkBtn.classList.add('bg-yellow-100', 'border-yellow-400', 'text-yellow-600');
      } else {
        icon.classList.remove('fas');
        icon.classList.add('far');
        bookmarkBtn.classList.remove('bg-yellow-100', 'border-yellow-400', 'text-yellow-600');
      }
    }
    
    // Agregar/quitar de favoritos
    function toggleFavorite() {
      if (!currentBookId) return;
      
      const favorites = JSON.parse(localStorage.getItem('favoriteBooks') || '[]');
      const isFavorite = favorites.includes(currentBookId);
      
      if (isFavorite) {
        // Quitar de favoritos
        const index = favorites.indexOf(currentBookId);
        favorites.splice(index, 1);
      } else {
        // Agregar a favoritos
        favorites.push(currentBookId);
      }
      
      localStorage.setItem('favoriteBooks', JSON.stringify(favorites));
      updateBookmarkButton();
    }
    
    // Filtrar libros
    function filterBooks() {
      filteredBooks = allBooks.filter(book => {
        const categoryMatch = currentCategory === 'all' || book.category === currentCategory;
        const searchLower = searchQuery.toLowerCase();
        const titleMatch = book.title.toLowerCase().includes(searchLower);
        const authorMatch = book.author.toLowerCase().includes(searchLower);
        
        return categoryMatch && (searchQuery === '' || titleMatch || authorMatch);
      });
      
      currentPage = 1;
      renderBooks();
      setupPagination();
    }
    
    // Configurar la paginación
    function setupPagination() {
      const totalPages = Math.ceil(filteredBooks.length / ITEMS_PER_PAGE);
      
      if (totalPages <= 1) {
        pagination.classList.add('hidden');
        return;
      }
      
      pagination.classList.remove('hidden');
      paginationDots.innerHTML = '';
      
      for (let i = 1; i <= totalPages; i++) {
        const dot = document.createElement('button');
        dot.className = `pagination-dot w-3 h-3 rounded-full bg-gray-300 ${i === currentPage ? 'active' : ''}`;
        dot.setAttribute('data-page', i);
        dot.addEventListener('click', () => {
          currentPage = i;
          renderBooks();
        });
        paginationDots.appendChild(dot);
      }
      
      updatePaginationControls();
    }
    
    // Actualizar controles de paginación
    function updatePaginationControls() {
      const totalPages = Math.ceil(filteredBooks.length / ITEMS_PER_PAGE);
      
      prevPagePagination.disabled = currentPage === 1;
      nextPagePagination.disabled = currentPage === totalPages;
      
      const dots = paginationDots.querySelectorAll('.pagination-dot');
      dots.forEach(dot => {
        const page = parseInt(dot.getAttribute('data-page'));
        dot.classList.toggle('active', page === currentPage);
      });
    }
    
    // Configurar event listeners
    function setupEventListeners() {
      retryButton.addEventListener('click', initApp);
      
      closeModal.addEventListener('click', () => {
        pdfModal.classList.add('hidden');
      });
      
      openNewTab.addEventListener('click', () => {
        if (currentBookUrl) {
          window.open(currentBookUrl, '_blank');
        }
      });
      
      retryPdf.addEventListener('click', () => {
        if (currentBookUrl) {
          loadPdf(currentBookUrl);
        }
      });
      
      // Controles del visor PDF
      bookmarkBtn.addEventListener('click', toggleFavorite);
      
      prevPageBtn.addEventListener('click', () => {
        const currentPage = parseInt(currentPageSpan.textContent);
        if (currentPage > 1) {
          currentPageSpan.textContent = currentPage - 1;
        }
      });
      
      nextPageBtn.addEventListener('click', () => {
        const currentPage = parseInt(currentPageSpan.textContent);
        const totalPages = parseInt(totalPagesSpan.textContent);
        if (currentPage < totalPages) {
          currentPageSpan.textContent = currentPage + 1;
        }
      });
      
      zoomInBtn.addEventListener('click', () => {
        alert('Función de zoom disponible en la versión completa.\nPor ahora, usa el botón "Abrir en nueva pestaña" para controles de zoom.');
      });
      
      zoomOutBtn.addEventListener('click', () => {
        alert('Función de zoom disponible en la versión completa.\nPor ahora, usa el botón "Abrir en nueva pestaña" para controles de zoom.');
      });
      
      searchInput.addEventListener('input', debounce(function() {
        searchQuery = this.value.trim();
        filterBooks();
      }, 300));
      
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          categoryButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          currentCategory = this.getAttribute('data-category');
          filterBooks();
        });
      });
      
      prevPagePagination.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderBooks();
        }
      });
      
      nextPagePagination.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredBooks.length / ITEMS_PER_PAGE);
        if (currentPage < totalPages) {
          currentPage++;
          renderBooks();
        }
      });
      
      pdfModal.addEventListener('click', function(e) {
        if (e.target === this) {
          pdfModal.classList.add('hidden');
        }
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !pdfModal.classList.contains('hidden')) {
          pdfModal.classList.add('hidden');
        }
      });
    }
    
    // Helpers
    function showLoadingState() {
      loadingState.classList.remove('hidden');
      booksGrid.classList.add('hidden');
      errorState.classList.add('hidden');
      emptyState.classList.add('hidden');
      pagination.classList.add('hidden');
    }
    
    function hideLoadingState() {
      loadingState.classList.add('hidden');
    }
    
    function showErrorState() {
      errorState.classList.remove('hidden');
      loadingState.classList.add('hidden');
      booksGrid.classList.add('hidden');
      emptyState.classList.add('hidden');
      pagination.classList.add('hidden');
    }
    
    function showEmptyState() {
      emptyState.classList.remove('hidden');
      booksGrid.classList.add('hidden');
      pagination.classList.add('hidden');
    }
    
    function hideEmptyState() {
      emptyState.classList.add('hidden');
    }
    
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func.apply(this, args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // Inicializar la aplicación
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>








