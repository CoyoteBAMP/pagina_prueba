
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Biblioteca Virtual</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #007AFF;
      --secondary: #FF2D55;
      --light: #FAFAFA;
      --dark: #333333;
      --text-secondary: #666666;
      --border-color: #E0E0E0;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--light);
      color: var(--dark);
    }
    
    .category-btn {
      transition: all 0.3s ease;
      border-bottom: 2px solid transparent;
      color: #555555;
      font-size: 14px;
    }
    
    .category-btn.active {
      background-color: transparent;
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
    }
    
    .book-card {
      transition: all 0.3s ease;
      height: 100%;
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }
    
    .book-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.08);
    }
    
    .book-cover {
      aspect-ratio: 2/3;
      object-fit: cover;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }
    
    .modal-overlay {
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .loader {
      border-top-color: var(--primary);
      animation: spinner 0.6s linear infinite;
    }
    
    @keyframes spinner {
      to {transform: rotate(360deg);}
    }
    
    .book-viewed::after {
      content: "";
      position: absolute;
      top: 10px;
      right: 10px;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--secondary);
      border: 2px solid white;
    }
    
    .search-bar:focus {
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
    }

    .pagination-dot {
      transition: all 0.2s ease;
    }
    
    .pagination-dot.active {
      background-color: var(--primary);
      transform: scale(1.3);
    }

    #pdf-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .pdf-error {
      background: #fee2e2;
      border: 1px solid #fecaca;
      color: #dc2626;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight text-primary">
          <i class="fas fa-book-open mr-2 text-gray-600"></i>Biblioteca Virtual
        </h1>
        <div class="relative w-full md:w-1/3">
          <input 
            type="text" 
            id="search" 
            class="search-bar w-full py-2 pl-10 pr-4 bg-white rounded-lg border border-gray-300 shadow-inner text-gray-700 placeholder-gray-400 focus:outline-none" 
            placeholder="Buscar por título o autor..."
          >
          <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Categorías -->
  <div class="bg-white shadow-sm">
    <div class="container mx-auto px-4 py-3">
      <div class="flex flex-wrap gap-4 justify-center md:justify-start">
        <button class="category-btn active px-3 py-2 font-medium" data-category="all">Todos</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="literatura">Literatura</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="ciencia">Ciencia</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="historia">Historia</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="tecnologia">Tecnología</button>
        <button class="category-btn px-3 py-2 font-medium" data-category="arte">Arte</button>
      </div>
    </div>
  </div>
  
  <!-- Contenedor principal -->
  <main class="container mx-auto px-4 py-8">
    <!-- Estado de carga -->
    <div id="loading-state" class="flex flex-col items-center justify-center py-20">
      <div class="loader h-12 w-12 border-4 border-gray-200 rounded-full"></div>
      <p class="mt-4 text-gray-600">Cargando biblioteca...</p>
    </div>
    
    <!-- Estado de error -->
    <div id="error-state" class="hidden flex flex-col items-center justify-center py-20 text-center">
      <div class="bg-red-100 p-6 rounded-lg">
        <i class="fas fa-exclamation-triangle text-red-500 text-5xl mb-4"></i>
        <h3 class="text-xl font-bold text-red-700">¡Ups! Algo salió mal</h3>
        <p class="text-red-600 mt-2">No pudimos cargar los libros. Por favor intenta de nuevo más tarde.</p>
        <button id="retry-button" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300">
          <i class="fas fa-redo mr-2"></i>Reintentar
        </button>
      </div>
    </div>
    
    <!-- Estado vacío -->
    <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center">
      <i class="fas fa-search text-6xl text-gray-400 mb-4"></i>
      <h3 class="text-xl font-bold text-gray-700">No encontramos resultados</h3>
      <p class="text-gray-600 mt-2">Intenta con otra búsqueda o categoría</p>
    </div>
    
    <!-- Grid de libros -->
    <div id="books-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <!-- Los libros se cargarán dinámicamente aquí -->
    </div>
    
    <!-- Paginación -->
    <div id="pagination" class="hidden flex justify-center items-center space-x-2 mt-10">
      <button id="prev-page" class="px-4 py-2 rounded-full border border-gray-300 hover:bg-gray-100">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div id="pagination-dots" class="flex space-x-2">
        <!-- Dots generados dinámicamente -->
      </div>
      <button id="next-page" class="px-4 py-2 rounded-full border border-gray-300 hover:bg-gray-100">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </main>
  
  <!-- Modal para visualizar PDF -->
  <div id="pdf-modal" class="modal-overlay hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-6xl h-full md:h-5/6 rounded-xl shadow-lg flex flex-col relative overflow-hidden">
      <!-- Header del modal -->
      <div class="flex justify-between items-center p-4 border-b">
        <h3 id="modal-book-title" class="text-xl font-semibold truncate">Título del libro</h3>
        <div class="flex items-center space-x-2">
          <button id="open-new-tab" class="text-gray-500 hover:text-gray-700" title="Abrir en nueva pestaña">
            <i class="fas fa-external-link-alt text-lg"></i>
          </button>
          <button id="close-modal" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
      </div>
      
      <!-- Contenedor del PDF -->
      <div id="pdf-container" class="flex-grow overflow-hidden relative">
        <!-- PDF Iframe -->
        <iframe id="pdf-iframe" class="hidden"></iframe>
        
        <!-- Mensaje de carga del PDF -->
        <div id="pdf-loading" class="absolute inset-0 flex flex-col items-center justify-center bg-white">
          <div class="loader h-10 w-10 border-4 border-gray-200 rounded-full"></div>
          <p class="mt-4 text-gray-600">Cargando documento...</p>
        </div>
        
        <!-- Mensaje de error -->
        <div id="pdf-error" class="hidden absolute inset-0 flex flex-col items-center justify-center p-8">
          <div class="pdf-error rounded-lg p-6 text-center max-w-md">
            <i class="fas fa-file-pdf text-4xl mb-4"></i>
            <h3 class="text-lg font-bold mb-2">No se pudo cargar el PDF</h3>
            <p class="mb-4">El archivo no se encuentra disponible o hay un problema de conexión.</p>
            <button id="retry-pdf" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
              Reintentar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuración básica
    const ITEMS_PER_PAGE = 12;
    let currentPage = 1;
    let currentCategory = 'all';
    let searchQuery = '';
    let allBooks = [];
    let filteredBooks = [];
    let currentBookUrl = '';
    
    // Referencias a elementos DOM
    const booksGrid = document.getElementById('books-grid');
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const emptyState = document.getElementById('empty-state');
    const retryButton = document.getElementById('retry-button');
    const searchInput = document.getElementById('search');
    const categoryButtons = document.querySelectorAll('.category-btn');
    const pdfModal = document.getElementById('pdf-modal');
    const closeModal = document.getElementById('close-modal');
    const openNewTab = document.getElementById('open-new-tab');
    const modalBookTitle = document.getElementById('modal-book-title');
    const pdfIframe = document.getElementById('pdf-iframe');
    const pdfLoading = document.getElementById('pdf-loading');
    const pdfError = document.getElementById('pdf-error');
    const retryPdf = document.getElementById('retry-pdf');
    const pagination = document.getElementById('pagination');
    const paginationDots = document.getElementById('pagination-dots');
    const prevPagePagination = document.getElementById('prev-page');
    const nextPagePagination = document.getElementById('next-page');
    
    // Datos de libros con PDFs reales
    function fetchBooks() {
      return new Promise((resolve) => {
        const mockBooks = [
          {
            id: 1,
            title: "Manual de JavaScript",
            author: "Mozilla Developer Network",
            category: "tecnologia",
            cover: "https://images.unsplash.com/photo-1627398242454-45a1465c2479?w=400",
            pdfUrl: "https://eloquentjavascript.net/Eloquent_JavaScript.pdf"
          },
          {
            id: 2,
            title: "Git Handbook",
            author: "GitHub",
            category: "tecnologia",
            cover: "https://images.unsplash.com/photo-1618401471353-b98afee0b2eb?w=400",
            pdfUrl: "https://github.github.com/training-kit/downloads/github-git-handbook.pdf"
          },
          {
            id: 3,
            title: "The Art of War",
            author: "Sun Tzu",
            category: "historia",
            cover: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400",
            pdfUrl: "https://www.gutenberg.org/files/132/132-pdf.pdf"
          },
          {
            id: 4,
            title: "Alice's Adventures in Wonderland",
            author: "Lewis Carroll",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=400",
            pdfUrl: "https://www.gutenberg.org/files/11/11-pdf.pdf"
          },
          {
            id: 5,
            title: "The Republic",
            author: "Plato",
            category: "historia",
            cover: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400",
            pdfUrl: "https://www.gutenberg.org/files/1497/1497-pdf.pdf"
          },
          {
            id: 6,
            title: "Pride and Prejudice",
            author: "Jane Austen",
            category: "literatura",
            cover: "https://images.unsplash.com/photo-1541963463532-d68292c34d19?w=400",
            pdfUrl: "https://www.gutenberg.org/files/1342/1342-pdf.pdf"
          }
        ];
        
        setTimeout(() => resolve(mockBooks), 1000);
      });
    }
    
    // Inicializa la aplicación
    function initApp() {
      showLoadingState();
      
      fetchBooks()
        .then(books => {
          allBooks = books;
          filteredBooks = [...allBooks];
          hideLoadingState();
          renderBooks();
          setupPagination();
        })
        .catch(error => {
          console.error("Error:", error);
          showErrorState();
        });
      
      setupEventListeners();
    }
    
    // Renderiza los libros en el grid
    function renderBooks() {
      booksGrid.innerHTML = '';
      
      const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIndex = startIndex + ITEMS_PER_PAGE;
      const booksToRender = filteredBooks.slice(startIndex, endIndex);
      
      if (booksToRender.length === 0) {
        showEmptyState();
        return;
      }
      
      hideEmptyState();
      booksGrid.classList.remove('hidden');
      
      booksToRender.forEach(book => {
        const bookCard = document.createElement('div');
        bookCard.className = 'book-card bg-white overflow-hidden relative cursor-pointer';
        bookCard.setAttribute('data-id', book.id);
        
        const viewedBooks = JSON.parse(localStorage.getItem('viewedBooks') || '[]');
        if (viewedBooks.includes(book.id)) {
          bookCard.classList.add('book-viewed');
        }
        
        bookCard.innerHTML = `
          <div class="h-48 sm:h-64 overflow-hidden">
            <img src="${book.cover}" alt="${book.title}" class="book-cover w-full h-full object-cover transition-transform duration-500 hover:scale-110">
          </div>
          <div class="p-4">
            <span class="inline-block px-3 py-1 text-xs font-semibold text-white bg-blue-500 rounded-full mb-2">${book.category}</span>
            <h3 class="font-semibold text-lg mb-1 line-clamp-1">${book.title}</h3>
            <p class="text-gray-600 text-sm mb-3">${book.author}</p>
            <button class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300">
              Leer PDF
            </button>
          </div>
        `;
        
        bookCard.addEventListener('click', () => openBookModal(book));
        booksGrid.appendChild(bookCard);
      });
      
      updatePaginationControls();
    }
    
    // Abrir el modal del libro
    function openBookModal(book) {
      pdfModal.classList.remove('hidden');
      modalBookTitle.textContent = book.title;
      currentBookUrl = book.pdfUrl;
      
      // Mostrar estado de carga
      pdfLoading.classList.remove('hidden');
      pdfIframe.classList.add('hidden');
      pdfError.classList.add('hidden');
      
      // Cargar PDF
      loadPdf(book.pdfUrl);
      
      // Marcar como visto
      const viewedBooks = JSON.parse(localStorage.getItem('viewedBooks') || '[]');
      if (!viewedBooks.includes(book.id)) {
        viewedBooks.push(book.id);
        localStorage.setItem('viewedBooks', JSON.stringify(viewedBooks));
      }
    }
    
    // Cargar PDF en el iframe
    function loadPdf(pdfUrl) {
      const iframe = pdfIframe;
      
      iframe.onload = function() {
        pdfLoading.classList.add('hidden');
        pdfError.classList.add('hidden');
        iframe.classList.remove('hidden');
      };
      
      iframe.onerror = function() {
        pdfLoading.classList.add('hidden');
        iframe.classList.add('hidden');
        pdfError.classList.remove('hidden');
      };
      
      // Usar el visor de PDF de Google Docs para mejor compatibilidad
      iframe.src = `https://docs.google.com/viewer?url=${encodeURIComponent(pdfUrl)}&embedded=true`;
      
      // Fallback después de 10 segundos
      setTimeout(() => {
        if (pdfLoading.classList.contains('hidden') === false) {
          pdfLoading.classList.add('hidden');
          pdfError.classList.remove('hidden');
        }
      }, 10000);
    }
    
    // Filtrar libros
    function filterBooks() {
      filteredBooks = allBooks.filter(book => {
        const categoryMatch = currentCategory === 'all' || book.category === currentCategory;
        const searchLower = searchQuery.toLowerCase();
        const titleMatch = book.title.toLowerCase().includes(searchLower);
        const authorMatch = book.author.toLowerCase().includes(searchLower);
        
        return categoryMatch && (searchQuery === '' || titleMatch || authorMatch);
      });
      
      currentPage = 1;
      renderBooks();
      setupPagination();
    }
    
    // Configurar la paginación
    function setupPagination() {
      const totalPages = Math.ceil(filteredBooks.length / ITEMS_PER_PAGE);
      
      if (totalPages <= 1) {
        pagination.classList.add('hidden');
        return;
      }
      
      pagination.classList.remove('hidden');
      paginationDots.innerHTML = '';
      
      for (let i = 1; i <= totalPages; i++) {
        const dot = document.createElement('button');
        dot.className = `pagination-dot w-3 h-3 rounded-full bg-gray-300 ${i === currentPage ? 'active' : ''}`;
        dot.setAttribute('data-page', i);
        dot.addEventListener('click', () => {
          currentPage = i;
          renderBooks();
        });
        paginationDots.appendChild(dot);
      }
      
      updatePaginationControls();
    }
    
    // Actualizar controles de paginación
    function updatePaginationControls() {
      const totalPages = Math.ceil(filteredBooks.length / ITEMS_PER_PAGE);
      
      prevPagePagination.disabled = currentPage === 1;
      nextPagePagination.disabled = currentPage === totalPages;
      
      const dots = paginationDots.querySelectorAll('.pagination-dot');
      dots.forEach(dot => {
        const page = parseInt(dot.getAttribute('data-page'));
        dot.classList.toggle('active', page === currentPage);
      });
    }
    
    // Configurar event listeners
    function setupEventListeners() {
      retryButton.addEventListener('click', initApp);
      
      closeModal.addEventListener('click', () => {
        pdfModal.classList.add('hidden');
      });
      
      openNewTab.addEventListener('click', () => {
        if (currentBookUrl) {
          window.open(currentBookUrl, '_blank');
        }
      });
      
      retryPdf.addEventListener('click', () => {
        if (currentBookUrl) {
          loadPdf(currentBookUrl);
        }
      });
      
      searchInput.addEventListener('input', debounce(function() {
        searchQuery = this.value.trim();
        filterBooks();
      }, 300));
      
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          categoryButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          currentCategory = this.getAttribute('data-category');
          filterBooks();
        });
      });
      
      prevPagePagination.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderBooks();
        }
      });
      
      nextPagePagination.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredBooks.length / ITEMS_PER_PAGE);
        if (currentPage < totalPages) {
          currentPage++;
          renderBooks();
        }
      });
      
      pdfModal.addEventListener('click', function(e) {
        if (e.target === this) {
          pdfModal.classList.add('hidden');
        }
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !pdfModal.classList.contains('hidden')) {
          pdfModal.classList.add('hidden');
        }
      });
    }
    
    // Helpers
    function showLoadingState() {
      loadingState.classList.remove('hidden');
      booksGrid.classList.add('hidden');
      errorState.classList.add('hidden');
      emptyState.classList.add('hidden');
      pagination.classList.add('hidden');
    }
    
    function hideLoadingState() {
      loadingState.classList.add('hidden');
    }
    
    function showErrorState() {
      errorState.classList.remove('hidden');
      loadingState.classList.add('hidden');
      booksGrid.classList.add('hidden');
      emptyState.classList.add('hidden');
      pagination.classList.add('hidden');
    }
    
    function showEmptyState() {
      emptyState.classList.remove('hidden');
      booksGrid.classList.add('hidden');
      pagination.classList.add('hidden');
    }
    
    function hideEmptyState() {
      emptyState.classList.add('hidden');
    }
    
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func.apply(this, args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // Inicializar la aplicación
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
